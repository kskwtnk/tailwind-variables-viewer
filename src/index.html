<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tailwind Variables Viewer</title>
  <link rel="stylesheet" href="/app.css">
</head>
<body>
  <div id="app">
    <header>
      <h1>Tailwind CSS v4 Theme Variables</h1>
      <input type="search" id="search" placeholder="Search variables..." class="search-bar">
    </header>
    <main id="variables">
      <p class="loading">Loading variables...</p>
    </main>
  </div>

  <script type="module">
    // Fetch and render variables
    let allVariables = null;

    fetch('/api/variables.json')
      .then(res => {
        if (!res.ok) {
          throw new Error('Failed to fetch variables');
        }
        return res.json();
      })
      .then(variables => {
        allVariables = variables;
        renderVariables(variables);
        setupSearch();
        setupCopyButtons();
      })
      .catch(error => {
        document.getElementById('variables').innerHTML = `
          <div class="error">
            <h2>Error</h2>
            <p>${error.message}</p>
          </div>
        `;
      });

    function renderVariables(variables) {
      const container = document.getElementById('variables');

      if (!variables || Object.keys(variables).length === 0) {
        container.innerHTML = `
          <div class="empty">
            <h2>No variables found</h2>
            <p>Make sure your CSS files contain @theme directives.</p>
          </div>
        `;
        return;
      }

      const html = Object.entries(variables).map(([namespace, vars]) => `
        <section class="namespace-section">
          <h2>${namespace} <span class="count">(${vars.length})</span></h2>
          <div class="variables-grid">
            ${vars.map(v => `
              <div class="variable-card" data-var-name="${v.varName}">
                ${renderPreview(v)}
                <div class="variable-info">
                  <code class="variable-name">${v.varName}</code>
                  <span class="variable-value">${v.value}</span>
                </div>
                <button class="copy-btn" data-text="${v.varName}">Copy</button>
              </div>
            `).join('')}
          </div>
        </section>
      `).join('');

      container.innerHTML = html;
    }

    function renderPreview(variable) {
      if (variable.type === 'color') {
        return `<div class="color-swatch" style="background: ${variable.value}"></div>`;
      }
      if (variable.type === 'size') {
        return `<div class="size-bar" style="width: ${variable.value}"></div>`;
      }
      if (variable.type === 'font') {
        return `<div class="font-sample" style="font-family: ${variable.value}">The quick brown fox</div>`;
      }
      return '';
    }

    function setupSearch() {
      const search = document.getElementById('search');
      search.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const cards = document.querySelectorAll('.variable-card');

        cards.forEach(card => {
          const name = card.dataset.varName.toLowerCase();
          card.style.display = name.includes(query) ? '' : 'none';
        });

        // Hide empty namespaces
        const sections = document.querySelectorAll('.namespace-section');
        sections.forEach(section => {
          const visibleCards = section.querySelectorAll('.variable-card[style=""], .variable-card:not([style*="display: none"])');
          section.style.display = visibleCards.length > 0 ? '' : 'none';
        });
      });
    }

    function setupCopyButtons() {
      document.getElementById('variables').addEventListener('click', async (e) => {
        if (e.target.classList.contains('copy-btn')) {
          const btn = e.target;
          const text = btn.dataset.text;

          try {
            await navigator.clipboard.writeText(text);
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => {
              btn.textContent = 'Copy';
              btn.classList.remove('copied');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        }
      });
    }
  </script>
</body>
</html>
